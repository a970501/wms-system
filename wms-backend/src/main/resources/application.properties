# Server Configuration
server.port=8080
server.servlet.context-path=/api

# Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/warehouse_db?useSSL=true&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
spring.datasource.username=${DB_USERNAME:wms_user}
spring.datasource.password=${DB_PASSWORD:wms_password123}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP Connection Pool - Optimized Configuration
# Maximum number of connections in the pool
spring.datasource.hikari.maximum-pool-size=20
# Minimum number of idle connections
spring.datasource.hikari.minimum-idle=5
# Maximum time to wait for a connection from the pool (30 seconds)
spring.datasource.hikari.connection-timeout=30000
# Maximum time a connection can sit idle in the pool (10 minutes)
spring.datasource.hikari.idle-timeout=600000
# Maximum lifetime of a connection in the pool (30 minutes)
spring.datasource.hikari.max-lifetime=1800000
# Connection test query
spring.datasource.hikari.connection-test-query=SELECT 1
# Pool name for monitoring
spring.datasource.hikari.pool-name=WMS-HikariPool
# Enable auto-commit
spring.datasource.hikari.auto-commit=true
# Leak detection threshold (10 seconds) - helps identify connection leaks
spring.datasource.hikari.leak-detection-threshold=10000
# Validation timeout (5 seconds)
spring.datasource.hikari.validation-timeout=5000

# JPA Configuration
# Disable open session in view to avoid lazy loading issues
spring.jpa.open-in-view=false
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect

# JPA Performance Optimization
# Enable second-level cache
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
# Enable query cache
spring.jpa.properties.hibernate.cache.use_query_cache=false
# Batch size for inserts/updates
spring.jpa.properties.hibernate.jdbc.batch_size=20
# Order inserts for better batching
spring.jpa.properties.hibernate.order_inserts=true
# Order updates for better batching
spring.jpa.properties.hibernate.order_updates=true
# Batch versioned data
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
# Generate statistics (disable in production for better performance)
spring.jpa.properties.hibernate.generate_statistics=false
# Default batch fetch size
spring.jpa.properties.hibernate.default_batch_fetch_size=16

# Logging
logging.level.root=INFO
logging.level.com.wms=INFO
logging.level.org.hibernate.SQL=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/wms-application.log
logging.file.max-size=10MB
logging.file.max-history=30

# JWT Configuration
jwt.secret=${JWT_SECRET:SmartStock-WMS-Secret-Key-2025-Very-Long-Secret-Key-For-Security}
jwt.expiration=86400000

# CORS Configuration
cors.allowed-origins=https://cl.bxyxr.com,https://www.mkctj.cn,http://localhost:8080,http://localhost:3000

# File Upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Swagger/OpenAPI
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.operations-sorter=alpha

# Spring Boot Actuator
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
# Backup Management Configuration
backup.directory=/opt/app/wms/backups
backup.frontend.path=/www/wwwroot/vue3-wms
backup.backend.path=/opt/app/wms/backend

# Scheduled Tasks
spring.task.scheduling.enabled=true
spring.task.scheduling.pool.size=5

# Email Configuration (SMTP)
spring.mail.host=${MAIL_HOST:smtp.qq.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:}
spring.mail.password=${MAIL_PASSWORD:}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# Log Report Notification
notification.enabled=${NOTIFICATION_ENABLED:false}
notification.email.to=${NOTIFICATION_EMAIL_TO:}
notification.email.from=${NOTIFICATION_EMAIL_FROM:}
notification.wechat.webhook=${WECHAT_WEBHOOK_URL:}
notification.interval-days=1

# WeChat Enterprise (企业微信) Application Message Configuration
wechat.work.corp-id=${WECHAT_WORK_CORP_ID:}
wechat.work.agent-id=${WECHAT_WORK_AGENT_ID:}
wechat.work.secret=${WECHAT_WORK_SECRET:}
wechat.work.enabled=${WECHAT_WORK_ENABLED:false}

# WeChat Official Account (微信公众号) Template Message Configuration
wechat.official.app-id=${WECHAT_OFFICIAL_APP_ID:}
wechat.official.app-secret=${WECHAT_OFFICIAL_APP_SECRET:}
wechat.official.template-id=${WECHAT_OFFICIAL_TEMPLATE_ID:}
wechat.official.enabled=${WECHAT_OFFICIAL_ENABLED:false}

# WeChat Mini Program (微信小程序) Subscription Message Configuration
wechat.mini.app-id=${WECHAT_MINI_APP_ID:}
wechat.mini.app-secret=${WECHAT_MINI_APP_SECRET:}
wechat.mini.template-id=${WECHAT_MINI_TEMPLATE_ID:}
wechat.mini.enabled=${WECHAT_MINI_ENABLED:false}

# WeChat Notification Service Configuration
wechat.notification.enabled=${WECHAT_NOTIFICATION_ENABLED:true}
wechat.notification.priority=${WECHAT_NOTIFICATION_PRIORITY:mini,official,work}
wechat.notification.fallback=${WECHAT_NOTIFICATION_FALLBACK:true}
