# WMS 仓库管理系统开发文档

## 1. 项目概述

WMS（Warehouse Management System）仓库管理系统是一套基于微信小程序和Spring Boot开发的现代化仓库管理解决方案。该系统提供了完整的库存管理、计件管理、工资统计、通知管理等功能，旨在提高仓库管理效率，减少人为错误，提升数据的准确性和实时性。

### 1.1 主要功能

- **库存管理**：商品入库、出库、库存查询、库存盘点
- **计件管理**：工人计件记录、计件统计、工资计算
- **工资统计**：按工人、产品、时间段统计工资
- **通知管理**：日志报告、邮件通知、微信通知
- **用户管理**：用户注册、登录、权限控制
- **数据导出**：Excel导出功能

### 1.2 系统特点

- 基于微信小程序的移动端解决方案，无需安装APP
- 前后端分离架构，便于维护和扩展
- RESTful API设计，接口规范统一
- 基于JWT的身份认证机制，安全性高
- 支持多种通知方式（邮件、微信）
- 完整的日志记录和审计功能

## 2. 技术栈

### 2.1 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| 微信小程序框架 | 基础库 2.10.0+ | 移动端应用开发 |
| JavaScript | ES6+ | 前端编程语言 |
| WXML | - | 页面结构定义 |
| WXSS | - | 样式定义 |
| 微信小程序API | - | 调用微信功能（如网络请求、存储等） |

### 2.2 后端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 2.7.18 | 后端应用框架 |
| Spring Data JPA | 2.7.18 | 数据访问层框架 |
| MySQL | 8.0+ | 数据库 |
| Java | 17 | 后端编程语言 |
| JWT | - | 身份认证 |
| Maven | 3.9.11 | 项目构建工具 |
| Swagger | 2.9.2 | API文档生成 |
| Apache POI | 4.1.2 | Excel导出 |
| Lombok | 1.18.28 | 代码简化工具 |

## 3. 系统架构

### 3.1 架构图

```
┌─────────────────────────┐
│   微信小程序前端        │
└─────────────────────────┘
            │
            ▼
┌─────────────────────────┐
│   Nginx 反向代理        │
└─────────────────────────┘
            │
            ▼
┌─────────────────────────┐
│   Spring Boot 后端      │
│  ┌────────────────────┐ │
│  │   Controller 层    │ │
│  └────────────────────┘ │
│  ┌────────────────────┐ │
│  │   Service 层       │ │
│  └────────────────────┘ │
│  ┌────────────────────┐ │
│  │   Repository 层    │ │
│  └────────────────────┘ │
└─────────────────────────┘
            │
            ▼
┌─────────────────────────┐
│   MySQL 数据库          │
└─────────────────────────┘
```

### 3.2 分层设计

#### 3.2.1 前端分层

- **页面层**：负责展示数据和用户交互
- **组件层**：可复用的UI组件
- **工具层**：通用工具函数
- **API层**：与后端API交互

#### 3.2.2 后端分层

- **Controller层**：处理HTTP请求，返回响应
- **Service层**：业务逻辑处理
- **Repository层**：数据访问层
- **Entity层**：数据模型
- **DTO层**：数据传输对象
- **Common层**：通用组件（异常处理、响应封装等）

## 4. 项目结构

### 4.1 前端项目结构

```
wms_frontend/
├── app.js             # 小程序入口文件
├── app.json           # 小程序全局配置
├── app.wxss           # 小程序全局样式
├── pages/             # 页面目录
│   ├── index/         # 首页
│   ├── login/         # 登录页
│   ├── inventory/     # 库存管理
│   ├── piecework/     # 计件管理
│   ├── profile/       # 个人中心
│   └── ...
├── components/        # 组件目录
│   ├── advanced-search/    # 高级搜索组件
│   ├── chart/              # 图表组件
│   └── offline-status/     # 离线状态组件
└── utils/             # 工具函数
    ├── request.js     # 网络请求封装
    ├── util.js        # 通用工具
    └── ...
```

### 4.2 后端项目结构

```
wms_backend/
├── src/               # 源代码目录
│   └── main/
│       ├── java/com/wms/
│       │   ├── annotation/    # 自定义注解
│       │   ├── common/        # 通用组件
│       │   ├── config/        # 配置类
│       │   ├── controller/    # 控制器
│       │   ├── dto/           # 数据传输对象
│       │   ├── entity/        # 实体类
│       │   ├── interceptor/   # 拦截器
│       │   ├── repository/    # 数据访问层
│       │   ├── scheduled/     # 定时任务
│       │   ├── service/       # 服务层
│       │   └── util/          # 工具类
│       └── resources/         # 资源文件
│           ├── application.properties    # 应用配置
│           └── logback.xml              # 日志配置
└── pom.xml            # Maven配置文件
```

## 5. 核心模块设计

### 5.1 库存管理模块

#### 5.1.1 功能说明

库存管理模块负责商品的入库、出库、库存查询和库存盘点等功能。

#### 5.1.2 主要实体

- `InventoryItem`：库存商品信息
- `InventoryLog`：库存变动日志

#### 5.1.3 主要接口

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/inventory/items | GET | 获取库存商品列表 |
| /api/inventory/items | POST | 添加库存商品 |
| /api/inventory/items/{id} | PUT | 更新库存商品 |
| /api/inventory/items/{id} | DELETE | 删除库存商品 |
| /api/inventory/logs | GET | 获取库存变动日志 |

### 5.2 计件管理模块

#### 5.2.1 功能说明

计件管理模块负责记录工人的计件信息，包括产品名称、规格、数量、单价等。

#### 5.2.2 主要实体

- `PieceWork`：计件记录
- `PriceTable`：单价表

#### 5.2.3 主要接口

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/piecework | GET | 获取计件记录列表 |
| /api/piecework | POST | 添加计件记录 |
| /api/piecework/{id} | PUT | 更新计件记录 |
| /api/piecework/{id} | DELETE | 删除计件记录 |
| /api/piecework/stats | GET | 获取计件统计信息 |

### 5.3 通知管理模块

#### 5.3.1 功能说明

通知管理模块负责发送系统日志报告、计件统计报告等通知信息，支持邮件和微信两种通知方式。

#### 5.3.2 主要类

- `NotificationController`：通知管理控制器
- `LogReportNotificationService`：日志报告通知服务
- `WeChatWorkService`：企业微信服务
- `WeChatOfficialService`：微信公众号服务
- `WeChatMiniService`：微信小程序服务

#### 5.3.3 主要接口

| 接口 | 方法 | 功能 |
|------|------|------|
| /api/notification/status | GET | 获取通知配置状态 |
| /api/notification/config | GET | 获取通知配置 |
| /api/notification/config | POST | 更新通知配置 |
| /api/notification/message-types | GET | 获取消息类型设置 |
| /api/notification/email-recipients | GET | 获取邮件接收者列表 |

## 6. API设计

### 6.1 接口规范

- 所有API接口都以`/api`为前缀
- 使用RESTful风格设计
- 接口响应格式统一，包含`code`、`message`、`data`三个字段
- 使用HTTP状态码表示请求结果

### 6.2 响应格式

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    // 响应数据
  }
}
```

### 6.3 错误码

| 错误码 | 含义 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 7. 数据库设计

### 7.1 数据库表关系

- `user` (用户) 与 `piece_work` (计件记录)：一对多关系
- `inventory_item` (库存商品) 与 `inventory_log` (库存日志)：一对多关系
- `price_table` (单价表) 与 `piece_work` (计件记录)：多对一关系

### 7.2 主要表结构

#### 7.2.1 用户表 (user)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | bigint | PK | 用户ID |
| username | varchar(50) | NOT NULL, UNIQUE | 用户名 |
| password | varchar(100) | NOT NULL | 密码（加密存储） |
| role | varchar(20) | NOT NULL | 角色（ADMIN/USER） |
| created_at | datetime | NOT NULL | 创建时间 |
| updated_at | datetime | NOT NULL | 更新时间 |

#### 7.2.2 计件记录表 (piece_work)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | bigint | PK | 记录ID |
| worker_name | varchar(50) | NOT NULL | 工人姓名 |
| product_name | varchar(100) | NOT NULL | 产品名称 |
| specification | varchar(100) | NOT NULL | 规格 |
| quantity | int | NOT NULL | 数量 |
| unit_price | decimal(10,2) | NOT NULL | 单价 |
| total_amount | decimal(10,2) | NOT NULL | 总金额 |
| work_date | datetime | NOT NULL | 工作日期 |
| created_by | varchar(50) | NOT NULL | 创建人 |
| created_at | datetime | NOT NULL | 创建时间 |
| updated_at | datetime | NOT NULL | 更新时间 |

#### 7.2.3 库存商品表 (inventory_item)

| 字段名 | 数据类型 | 约束 | 描述 |
|--------|----------|------|------|
| id | bigint | PK | 商品ID |
| product_name | varchar(100) | NOT NULL | 商品名称 |
| specification | varchar(100) | NOT NULL | 规格 |
| material | varchar(50) | NOT NULL | 材质 |
| quantity | int | NOT NULL | 数量 |
| unit_price | decimal(10,2) | NOT NULL | 单价 |
| total_value | decimal(10,2) | NOT NULL | 总价值 |
| created_by | varchar(50) | NOT NULL | 创建人 |
| created_at | datetime | NOT NULL | 创建时间 |
| updated_at | datetime | NOT NULL | 更新时间 |

## 8. 安全设计

### 8.1 身份认证

系统使用JWT（JSON Web Token）进行身份认证：

1. 用户登录成功后，服务器生成JWT令牌
2. 客户端将令牌存储在本地
3. 后续请求将令牌放在Authorization头中
4. 服务器验证令牌的有效性

### 8.2 权限控制

系统使用基于角色的访问控制（RBAC）：

- 定义了ADMIN和USER两种角色
- 使用`@RequireAuth`注解要求用户认证
- 使用`@RequireRole`注解要求特定角色

### 8.3 数据安全

- 密码使用BCrypt算法加密存储
- 敏感数据传输使用HTTPS
- 输入数据进行严格验证
- 防止SQL注入攻击

## 9. 部署与维护

### 9.1 系统部署

- 前端：通过微信开发者工具上传到微信小程序平台
- 后端：使用Maven打包成JAR文件，部署到服务器

### 9.2 环境要求

| 环境 | 要求 |
|------|------|
| JDK | 17+ |
| MySQL | 8.0+ |
| 内存 | 至少2GB |
| 磁盘空间 | 至少10GB |

### 9.3 配置文件

后端配置文件路径：`src/main/resources/application.properties`

主要配置项：

```properties
# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/wms?useSSL=false&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=password

# JWT配置
jwt.secret=your-secret-key
jwt.expiration=3600

# 邮件配置
spring.mail.host=smtp.qq.com
spring.mail.port=587
spring.mail.username=your-email@qq.com
spring.mail.password=your-email-password

# 微信配置
wechat.work.webhook=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=your-key
wechat.official.app-id=your-app-id
wechat.official.app-secret=your-app-secret
```

## 10. 开发规范

### 10.1 命名规范

- 包名：使用小写字母，单词之间用点分隔
- 类名：使用驼峰命名法，首字母大写
- 方法名：使用驼峰命名法，首字母小写
- 变量名：使用驼峰命名法，首字母小写
- 常量名：使用大写字母，单词之间用下划线分隔

### 10.2 代码格式

- 使用4个空格进行缩进
- 每行代码长度不超过120个字符
- 方法之间使用空行分隔
- 逻辑块之间使用空行分隔
- 注释清晰，解释代码的功能和逻辑

### 10.3 版本控制

- 使用Git进行版本控制
- 提交信息清晰，使用中英文混合
- 分支管理：使用master、develop、feature分支模型

## 11. 总结

WMS仓库管理系统是一套功能完整、架构清晰、技术先进的仓库管理解决方案。系统采用了前后端分离的架构设计，使用了现代化的技术栈，具有良好的扩展性和可维护性。该系统可以帮助企业提高仓库管理效率，减少人为错误，提升数据的准确性和实时性，从而降低管理成本，提高企业竞争力。