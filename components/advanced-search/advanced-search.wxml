<!-- components/advanced-search/advanced-search.wxml -->
<view class="search-overlay" wx:if="{{visible}}" bindtap="onClose">
  <view class="search-panel" catchtap="">
    <!-- æœç´¢å¤´éƒ¨ -->
    <view class="search-header">
      <text class="search-title">é«˜çº§æœç´¢</text>
      <view class="search-actions">
        <button class="reset-btn" size="mini" bindtap="onReset">é‡ç½®</button>
        <text class="close-btn" bindtap="onClose">âœ•</text>
      </view>
    </view>

    <!-- æœç´¢è¡¨å• -->
    <scroll-view class="search-form" scroll-y>
      <view class="form-section">
        <view class="section-title">æœç´¢æ¡ä»¶</view>
        
        <view class="field-group" wx:for="{{fields}}" wx:key="key">
          <!-- æ–‡æœ¬è¾“å…¥ -->
          <view wx:if="{{item.type === 'input'}}" class="form-field">
            <text class="field-label">{{item.label}}</text>
            <input
              class="field-input"
              type="text"
              placeholder="{{item.placeholder || 'è¯·è¾“å…¥' + item.label}}"
              value="{{searchForm[item.key] || ''}}"
              data-field="{{item.key}}"
              bindinput="onFieldInput"
            />
          </view>

          <!-- é€‰æ‹©å™¨ -->
          <view wx:elif="{{item.type === 'picker'}}" class="form-field">
            <text class="field-label">{{item.label}}</text>
            <picker
              range="{{item.options}}"
              value="{{searchForm[item.key + '_index'] || 0}}"
              data-field="{{item.key}}"
              bindchange="onPickerChange"
            >
              <view class="picker-display">
                <text class="picker-text {{!searchForm[item.key] ? 'placeholder' : ''}}">
                  {{searchForm[item.key] || item.placeholder || 'è¯·é€‰æ‹©' + item.label}}
                </text>
                <text class="picker-arrow">â–¼</text>
              </view>
            </picker>
          </view>

          <!-- æ—¥æœŸé€‰æ‹© -->
          <view wx:elif="{{item.type === 'date'}}" class="form-field">
            <text class="field-label">{{item.label}}</text>
            <picker
              mode="date"
              value="{{searchForm[item.key] || ''}}"
              data-field="{{item.key}}"
              bindchange="onDateChange"
            >
              <view class="picker-display">
                <text class="picker-text {{!searchForm[item.key] ? 'placeholder' : ''}}">
                  {{searchForm[item.key] || item.placeholder || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
                </text>
                <text class="picker-arrow">ğŸ“…</text>
              </view>
            </picker>
          </view>

          <!-- æ•°å­—è¾“å…¥ -->
          <view wx:elif="{{item.type === 'number'}}" class="form-field">
            <text class="field-label">{{item.label}}</text>
            <input
              class="field-input"
              type="digit"
              placeholder="{{item.placeholder || 'è¯·è¾“å…¥æ•°å­—'}}"
              value="{{searchForm[item.key] || ''}}"
              data-field="{{item.key}}"
              bindinput="onFieldInput"
            />
          </view>
        </view>
      </view>

      <!-- æœç´¢å†å² -->
      <view class="history-section" wx:if="{{searchHistory.length > 0}}">
        <view class="section-header">
          <text class="section-title">æœç´¢å†å²</text>
          <view class="section-actions">
            <text class="toggle-btn" bindtap="toggleHistory">
              {{showHistory ? 'æ”¶èµ·' : 'å±•å¼€'}}
            </text>
            <text class="clear-btn" bindtap="clearHistory">æ¸…ç©º</text>
          </view>
        </view>
        
        <view class="history-list" wx:if="{{showHistory}}">
          <view 
            class="history-item" 
            wx:for="{{searchHistory}}" 
            wx:key="timestamp"
            data-index="{{index}}"
            bindtap="useHistorySearch"
          >
            <text class="history-text">{{item.text}}</text>
            <text 
              class="history-delete" 
              data-index="{{index}}"
              catchtap="deleteHistory"
            >Ã—</text>
          </view>
        </view>
      </view>

      <!-- çƒ­é—¨æœç´¢ -->
      <view class="hot-section" wx:if="{{hotSearches.length > 0}}">
        <view class="section-title">çƒ­é—¨æœç´¢</view>
        <view class="hot-tags">
          <text 
            class="hot-tag" 
            wx:for="{{hotSearches}}" 
            wx:key="text"
            data-text="{{item.text}}"
            data-type="{{item.type}}"
            bindtap="useHotSearch"
          >
            {{item.text}}
          </text>
        </view>
      </view>
    </scroll-view>

    <!-- æœç´¢æŒ‰é’® -->
    <view class="search-footer">
      <button class="search-btn" type="primary" bindtap="onSearch">
        å¼€å§‹æœç´¢
      </button>
      <button class="voice-btn" size="mini" bindtap="onQuickSearch">
        ğŸ¤ è¯­éŸ³
      </button>
    </view>
  </view>
</view>