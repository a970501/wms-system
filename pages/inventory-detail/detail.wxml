<!-- pages/inventory-detail/detail.wxml -->
<view class="container">
  <view class="detail-card" wx:if="{{item}}">
    <!-- å¤´éƒ¨ï¼šäº§å“åç§°å’Œæ•°é‡ -->
    <view class="header {{type}}">
      <view class="title-row">
        <text class="product-name">{{item.productName}}</text>
        <text class="type-tag">{{typeNames[type]}}</text>
      </view>
      <view class="quantity-row">
        <text class="quantity-value {{item.quantity < 0 ? 'negative' : ''}}">{{item.quantity}}</text>
        <text class="quantity-unit">{{item.unit || 'ä¸ª'}}</text>
      </view>
      <!-- å¿«æ·æ“ä½œæŒ‰é’® -->
      <view class="quick-actions">
        <view class="quick-btn add" bindtap="quickAdjust" data-type="add">
          <text class="quick-icon">+</text>
          <text>å…¥åº“</text>
        </view>
        <view class="quick-btn reduce" bindtap="quickAdjust" data-type="reduce">
          <text class="quick-icon">-</text>
          <text>å‡ºåº“</text>
        </view>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">è§„æ ¼ï¼š</text>
        <text class="value">{{item.specification || '-'}}</text>
      </view>
      <view class="info-row">
        <text class="label">æè´¨ï¼š</text>
        <text class="value">{{item.material || '-'}}</text>
      </view>
      <view class="info-row" wx:if="{{item.connectionType}}">
        <text class="label">è¿æ¥ç±»å‹ï¼š</text>
        <text class="value">{{item.connectionType}}</text>
      </view>
    </view>

    <!-- åº“å­˜ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">åº“å­˜ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">å½“å‰æ•°é‡ï¼š</text>
        <text class="value highlight {{item.quantity < 0 ? 'negative' : ''}}">{{item.quantity}} {{item.unit || 'ä¸ª'}}</text>
      </view>
      <view class="info-row" wx:if="{{item.minStock !== undefined && item.minStock !== null}}">
        <text class="label">æœ€ä½åº“å­˜ï¼š</text>
        <text class="value">{{item.minStock}}</text>
      </view>
      <view class="info-row" wx:if="{{item.maxStock !== undefined && item.maxStock !== null}}">
        <text class="label">æœ€é«˜åº“å­˜ï¼š</text>
        <text class="value">{{item.maxStock}}</text>
      </view>
      <view class="info-row" wx:if="{{item.location}}">
        <text class="label">å­˜æ”¾ä½ç½®ï¼š</text>
        <text class="value">{{item.location}}</text>
      </view>
    </view>

    <!-- å†å²å¢å‡è®°å½• -->
    <view class="section">
      <view class="section-title">ğŸ“ˆ å†å²å¢å‡è®°å½•</view>
      <view class="history-list" wx:if="{{history && history.length > 0}}">
        <view class="history-item" wx:for="{{history}}" wx:key="id">
          <view class="history-header">
            <text class="history-type {{item.quantity_change > 0 ? 'increase' : 'decrease'}}">
              {{item.quantity_change > 0 ? '+' : ''}}{{item.quantity_change}}
            </text>
            <text class="history-date">{{item.created_at}}</text>
          </view>
          
          <!-- äº§å“ä¿¡æ¯æ ‡ç­¾ -->
          <view class="history-tags">
            <text class="tag spec-tag" wx:if="{{item.specification}}">{{item.specification}}</text>
            <text class="tag material-tag" wx:if="{{item.material}}">{{item.material}}</text>
            <text class="tag connection-tag" wx:if="{{item.connection_type}}">{{item.connection_type}}</text>
          </view>
          
          <view class="history-body">
            <text class="history-detail">ç±»å‹: {{item.inventory_type === 'parts' ? 'é›¶ä»¶å…¥åº“' : item.inventory_type === 'blank' ? 'æ¯›å¯æ¶ˆè€—' : 'æˆå“'}}</text>
            <text class="history-detail" wx:if="{{item.worker_name}}">å·¥äºº: {{item.worker_name}}</text>
          </view>
          <view class="history-footer" wx:if="{{item.original_quantity !== undefined}}">
            <text class="history-balance">å˜åŠ¨å‰: {{item.original_quantity}} â†’ å˜åŠ¨å: {{item.original_quantity + item.quantity_change}}</text>
          </view>
        </view>
      </view>
      <view class="empty-history" wx:else>
        <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
      </view>
    </view>

    <!-- ä¾›åº”å•†ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰ -->
    <view class="section" wx:if="{{item.supplier || item.supplierName}}">
      <view class="section-title">ä¾›åº”å•†ä¿¡æ¯</view>
      <view class="info-row">
        <text class="label">ä¾›åº”å•†ï¼š</text>
        <text class="value">{{item.supplier || item.supplierName}}</text>
      </view>
      <view class="info-row" wx:if="{{item.supplierContact}}">
        <text class="label">è”ç³»æ–¹å¼ï¼š</text>
        <text class="value">{{item.supplierContact}}</text>
      </view>
    </view>

    <!-- æ—¶é—´ä¿¡æ¯ -->
    <view class="section">
      <view class="section-title">å…¶ä»–ä¿¡æ¯</view>
      <view class="info-row" wx:if="{{item.createdTime}}">
        <text class="label">åˆ›å»ºæ—¶é—´ï¼š</text>
        <text class="value">{{item.createdTime}}</text>
      </view>
      <view class="info-row" wx:if="{{item.updatedTime}}">
        <text class="label">æ›´æ–°æ—¶é—´ï¼š</text>
        <text class="value">{{item.updatedTime}}</text>
      </view>
      <view class="info-row" wx:if="{{item.lastInTime}}">
        <text class="label">æœ€åå…¥åº“ï¼š</text>
        <text class="value">{{item.lastInTime}}</text>
      </view>
      <view class="info-row" wx:if="{{item.lastOutTime}}">
        <text class="label">æœ€åå‡ºåº“ï¼š</text>
        <text class="value">{{item.lastOutTime}}</text>
      </view>
      <view class="info-row" wx:if="{{item.remarks}}">
        <text class="label">å¤‡æ³¨ï¼š</text>
        <text class="value">{{item.remarks}}</text>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:else>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar" wx:if="{{item && type !== 'finished'}}">
    <view class="action-btn edit-btn" bindtap="editItem">
      <text class="btn-icon">âœï¸</text>
      <text>ä¿®æ”¹</text>
    </view>
    <view class="action-btn delete-btn" bindtap="deleteItem">
      <text class="btn-icon">ğŸ—‘ï¸</text>
      <text>åˆ é™¤</text>
    </view>
  </view>

  <!-- æ•°é‡è°ƒæ•´å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showAdjustModal}}" bindtap="closeModal"></view>
  <view class="modal-content" wx:if="{{showAdjustModal}}">
    <view class="modal-header">
      <text class="modal-title">{{adjustType === 'add' ? 'å…¥åº“' : 'å‡ºåº“'}}</text>
      <text class="modal-close" bindtap="closeModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <text class="input-label">{{adjustType === 'add' ? 'å…¥åº“' : 'å‡ºåº“'}}æ•°é‡</text>
        <input class="input-field" type="number" placeholder="è¯·è¾“å…¥æ•°é‡" value="{{adjustQuantity}}" bindinput="onAdjustInput"/>
      </view>
      <view class="input-group">
        <text class="input-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
        <input class="input-field" placeholder="è¯·è¾“å…¥å¤‡æ³¨" value="{{adjustRemark}}" bindinput="onRemarkInput"/>
      </view>
    </view>
    <view class="modal-footer">
      <view class="modal-btn cancel" bindtap="closeModal">å–æ¶ˆ</view>
      <view class="modal-btn confirm" bindtap="confirmAdjust">ç¡®å®š</view>
    </view>
  </view>
</view>

