<!--pages/developer-tools/developer-tools.wxml-->
<view class="developer-tools">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-main">
      <text class="page-title">ğŸ› ï¸ å¼€å‘è€…å·¥å…·</text>
      <view class="admin-badge">
        <text class="admin-text">ç®¡ç†å‘˜ä¸“ç”¨</text>
      </view>
    </view>
    <text class="page-subtitle">æ€§èƒ½ç›‘æ§ Â· è°ƒè¯•å·¥å…· Â· ç³»ç»Ÿä¿¡æ¯</text>
  </view>

  <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
  <view class="tab-bar">
    <view class="tab-item {{currentTab === 'performance' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="performance">
      <text class="tab-icon">ğŸ“Š</text>
      <text class="tab-text">æ€§èƒ½ç›‘æ§</text>
    </view>
    <view class="tab-item {{currentTab === 'debug' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="debug">
      <text class="tab-icon">ğŸ›</text>
      <text class="tab-text">è°ƒè¯•å·¥å…·</text>
    </view>
    <view class="tab-item {{currentTab === 'system' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="system">
      <text class="tab-icon">âš™ï¸</text>
      <text class="tab-text">ç³»ç»Ÿä¿¡æ¯</text>
    </view>
    <view class="tab-item {{currentTab === 'logs' ? 'active' : ''}}" 
          bindtap="switchTab" data-tab="logs">
      <text class="tab-icon">ğŸ“</text>
      <text class="tab-text">æ—¥å¿—æŸ¥çœ‹</text>
    </view>
  </view>

  <!-- æ€§èƒ½ç›‘æ§ -->
  <view wx:if="{{currentTab === 'performance'}}" class="performance-tab">
    <!-- æ€§èƒ½æ¦‚è§ˆ -->
    <view class="performance-overview">
      <view class="metric-card">
        <text class="metric-title">é¡µé¢åŠ è½½æ—¶é—´</text>
        <text class="metric-value">{{performanceData.pageLoadTime}}ms</text>
        <text class="metric-status {{performanceData.pageLoadStatus}}">{{performanceData.pageLoadStatusText}}</text>
      </view>
      
      <view class="metric-card">
        <text class="metric-title">APIå“åº”æ—¶é—´</text>
        <text class="metric-value">{{performanceData.apiResponseTime}}ms</text>
        <text class="metric-status {{performanceData.apiResponseStatus}}">{{performanceData.apiResponseStatusText}}</text>
      </view>
      
      <view class="metric-card">
        <text class="metric-title">å†…å­˜ä½¿ç”¨</text>
        <text class="metric-value">{{performanceData.memoryUsage}}MB</text>
        <text class="metric-status {{performanceData.memoryStatus}}">{{performanceData.memoryStatusText}}</text>
      </view>
      
      <view class="metric-card">
        <text class="metric-title">FPS</text>
        <text class="metric-value">{{performanceData.fps}}</text>
        <text class="metric-status {{performanceData.fpsStatus}}">{{performanceData.fpsStatusText}}</text>
      </view>
    </view>

    <!-- æ€§èƒ½å›¾è¡¨ -->
    <view class="performance-charts">
      <view class="chart-container">
        <text class="chart-title">æ€§èƒ½è¶‹åŠ¿</text>
        <chart type="line" data="{{performanceChartData}}" width="100%" height="300rpx"></chart>
      </view>
    </view>

    <!-- æ€§èƒ½å»ºè®® -->
    <view wx:if="{{performanceRecommendations.length > 0}}" class="performance-recommendations">
      <text class="section-title">ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®</text>
      <view wx:for="{{performanceRecommendations}}" wx:key="id" class="recommendation-item">
        <view class="recommendation-header">
          <text class="recommendation-type">{{item.type}}</text>
          <text class="recommendation-priority {{item.priority}}">{{item.priorityText}}</text>
        </view>
        <text class="recommendation-message">{{item.message}}</text>
        <text class="recommendation-action">å»ºè®®æ“ä½œ: {{item.action}}</text>
      </view>
    </view>

    <!-- æ€§èƒ½æ“ä½œ -->
    <view class="performance-actions">
      <button class="action-btn primary" bindtap="startPerformanceMonitoring">
        {{isMonitoring ? 'åœæ­¢ç›‘æ§' : 'å¼€å§‹ç›‘æ§'}}
      </button>
      <button class="action-btn" bindtap="clearPerformanceData">æ¸…ç©ºæ•°æ®</button>
      <button class="action-btn" bindtap="exportPerformanceReport">å¯¼å‡ºæŠ¥å‘Š</button>
    </view>
  </view>

  <!-- è°ƒè¯•å·¥å…· -->
  <view wx:if="{{currentTab === 'debug'}}" class="debug-tab">
    <!-- è°ƒè¯•æ§åˆ¶å° -->
    <view class="debug-console">
      <view class="console-header">
        <text class="console-title">è°ƒè¯•æ§åˆ¶å°</text>
        <view class="console-controls">
          <button class="control-btn" bindtap="clearConsole">æ¸…ç©º</button>
          <button class="control-btn" bindtap="toggleAutoScroll">
            {{autoScroll ? 'å…³é—­è‡ªåŠ¨æ»šåŠ¨' : 'å¼€å¯è‡ªåŠ¨æ»šåŠ¨'}}
          </button>
        </view>
      </view>
      
      <scroll-view class="console-content" scroll-y="true" scroll-top="{{consoleScrollTop}}">
        <view wx:for="{{consoleLogs}}" wx:key="id" class="console-log {{item.level}}">
          <text class="log-time">{{formatTime(item.timestamp)}}</text>
          <text class="log-level">[{{item.level.toUpperCase()}}]</text>
          <text class="log-message">{{item.message}}</text>
          <view wx:if="{{item.data}}" class="log-data">
            <text>{{JSON.stringify(item.data)}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- ç½‘ç»œè¯·æ±‚ç›‘æ§ -->
    <view class="network-monitor">
      <text class="section-title">ğŸŒ ç½‘ç»œè¯·æ±‚ç›‘æ§</text>
      <view wx:for="{{networkRequests}}" wx:key="id" class="request-item">
        <view class="request-header">
          <text class="request-method {{item.method}}">{{item.method}}</text>
          <text class="request-url">{{item.url}}</text>
          <text class="request-status {{item.statusClass}}">{{item.status}}</text>
        </view>
        <view class="request-details">
          <text class="request-time">è€—æ—¶: {{item.duration}}ms</text>
          <text class="request-size">å¤§å°: {{item.size}}KB</text>
          <text class="request-timestamp">{{formatTime(item.timestamp)}}</text>
        </view>
      </view>
    </view>

    <!-- è°ƒè¯•å·¥å…· -->
    <view class="debug-tools">
      <text class="section-title">ğŸ”§ è°ƒè¯•å·¥å…·</text>
      <view class="tool-grid">
        <view class="tool-item" bindtap="inspectElement">
          <text class="tool-icon">ğŸ”</text>
          <text class="tool-name">å…ƒç´ æ£€æŸ¥</text>
        </view>
        <view class="tool-item" bindtap="measurePerformance">
          <text class="tool-icon">â±ï¸</text>
          <text class="tool-name">æ€§èƒ½æµ‹é‡</text>
        </view>
        <view class="tool-item" bindtap="testAPI">
          <text class="tool-icon">ğŸŒ</text>
          <text class="tool-name">APIæµ‹è¯•</text>
        </view>
        <view class="tool-item" bindtap="simulateError">
          <text class="tool-icon">âš ï¸</text>
          <text class="tool-name">é”™è¯¯æ¨¡æ‹Ÿ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç³»ç»Ÿä¿¡æ¯ -->
  <view wx:if="{{currentTab === 'system'}}" class="system-tab">
    <!-- å½“å‰ç”¨æˆ·ä¿¡æ¯ -->
    <view class="user-info-section">
      <text class="section-title">ğŸ‘¤ å½“å‰ç”¨æˆ·ä¿¡æ¯</text>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">ç”¨æˆ·å</text>
          <text class="info-value">{{currentUserInfo.username}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç”¨æˆ·è§’è‰²</text>
          <text class="info-value">{{currentUserInfo.role === 'ADMIN' ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}}</text>
        </view>
        <view class="info-item copyable" bindtap="copyUserInfo" data-type="userId" data-value="{{currentUserInfo.userId}}">
          <text class="info-label">ç”¨æˆ·ID</text>
          <view class="info-value-container">
            <text class="info-value">{{currentUserInfo.userId}}</text>
            <text class="copy-icon">ğŸ“‹</text>
          </view>
        </view>
        <view class="info-item copyable" bindtap="copyUserInfo" data-type="openId" data-value="{{currentUserInfo.openId}}">
          <text class="info-label">OpenID</text>
          <view class="info-value-container">
            <text class="info-value">{{currentUserInfo.openId}}</text>
            <text class="copy-icon">ğŸ“‹</text>
          </view>
        </view>
        <view class="info-item copyable" bindtap="copyUserInfo" data-type="unionId" data-value="{{currentUserInfo.unionId}}">
          <text class="info-label">UnionID</text>
          <view class="info-value-container">
            <text class="info-value">{{currentUserInfo.unionId}}</text>
            <text class="copy-icon">ğŸ“‹</text>
          </view>
        </view>
        <view class="info-item">
          <text class="info-label">ä¼šè¯å¯†é’¥</text>
          <text class="info-value">{{currentUserInfo.sessionKey}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç™»å½•æ—¶é—´</text>
          <text class="info-value">{{currentUserInfo.loginTime}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æœ€åæ´»è·ƒ</text>
          <text class="info-value">{{currentUserInfo.lastActiveTime}}</text>
        </view>
      </view>
    </view>

    <!-- è®¾å¤‡ä¿¡æ¯ -->
    <view class="system-info">
      <text class="section-title">ğŸ“± è®¾å¤‡ä¿¡æ¯</text>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">è®¾å¤‡å‹å·</text>
          <text class="info-value">{{systemInfo.model}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç³»ç»Ÿç‰ˆæœ¬</text>
          <text class="info-value">{{systemInfo.system}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å¾®ä¿¡ç‰ˆæœ¬</text>
          <text class="info-value">{{systemInfo.version}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">åŸºç¡€åº“ç‰ˆæœ¬</text>
          <text class="info-value">{{systemInfo.SDKVersion}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å±å¹•å°ºå¯¸</text>
          <text class="info-value">{{systemInfo.screenWidth}}x{{systemInfo.screenHeight}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å¯ç”¨å†…å­˜</text>
          <text class="info-value">{{systemInfo.benchmarkLevel}}</text>
        </view>
      </view>
    </view>

    <!-- åº”ç”¨ä¿¡æ¯ -->
    <view class="app-info">
      <text class="section-title">ğŸ“¦ åº”ç”¨ä¿¡æ¯</text>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">åº”ç”¨ç‰ˆæœ¬</text>
          <text class="info-value">{{appInfo.version}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ„å»ºæ—¶é—´</text>
          <text class="info-value">{{appInfo.buildTime}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">è¿è¡Œæ—¶é•¿</text>
          <text class="info-value">{{appInfo.uptime}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">é¡µé¢æ•°é‡</text>
          <text class="info-value">{{appInfo.pageCount}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç¼“å­˜å¤§å°</text>
          <text class="info-value">{{appInfo.cacheSize}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å­˜å‚¨ä½¿ç”¨</text>
          <text class="info-value">{{appInfo.storageUsage}}</text>
        </view>
      </view>
    </view>

    <!-- ç¯å¢ƒå˜é‡ -->
    <view class="env-info">
      <text class="section-title">ğŸŒ ç¯å¢ƒå˜é‡</text>
      <view wx:for="{{envVariables}}" wx:key="key" class="env-item">
        <text class="env-key">{{item.key}}</text>
        <text class="env-value">{{item.value}}</text>
      </view>
    </view>
  </view>

  <!-- æ—¥å¿—æŸ¥çœ‹ -->
  <view wx:if="{{currentTab === 'logs'}}" class="logs-tab">
    <!-- æ—¥å¿—è¿‡æ»¤ -->
    <view class="log-filters">
      <view class="filter-group">
        <text class="filter-label">çº§åˆ«:</text>
        <view class="filter-options">
          <view class="filter-option {{logFilter.level === 'all' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="level" data-value="all">å…¨éƒ¨</view>
          <view class="filter-option {{logFilter.level === 'error' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="level" data-value="error">é”™è¯¯</view>
          <view class="filter-option {{logFilter.level === 'warn' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="level" data-value="warn">è­¦å‘Š</view>
          <view class="filter-option {{logFilter.level === 'info' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="level" data-value="info">ä¿¡æ¯</view>
          <view class="filter-option {{logFilter.level === 'debug' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="level" data-value="debug">è°ƒè¯•</view>
        </view>
      </view>
      
      <view class="filter-group">
        <text class="filter-label">æ—¶é—´:</text>
        <view class="filter-options">
          <view class="filter-option {{logFilter.time === 'all' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="time" data-value="all">å…¨éƒ¨</view>
          <view class="filter-option {{logFilter.time === 'hour' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="time" data-value="hour">1å°æ—¶</view>
          <view class="filter-option {{logFilter.time === 'day' ? 'active' : ''}}" 
                bindtap="setLogFilter" data-type="time" data-value="day">ä»Šå¤©</view>
        </view>
      </view>
    </view>

    <!-- æ—¥å¿—åˆ—è¡¨ -->
    <view class="logs-container">
      <scroll-view class="logs-scroll" scroll-y="true">
        <view wx:for="{{filteredLogs}}" wx:key="id" class="log-entry {{item.level}}">
          <view class="log-header">
            <text class="log-timestamp">{{formatFullTime(item.timestamp)}}</text>
            <text class="log-level-badge">{{item.level.toUpperCase()}}</text>
          </view>
          <text class="log-content">{{item.message}}</text>
          <view wx:if="{{item.stack}}" class="log-stack">
            <text>{{item.stack}}</text>
          </view>
          <view wx:if="{{item.context}}" class="log-context">
            <text class="context-title">ä¸Šä¸‹æ–‡:</text>
            <text class="context-data">{{JSON.stringify(item.context)}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- æ—¥å¿—æ“ä½œ -->
    <view class="log-actions">
      <button class="action-btn" bindtap="refreshLogs">åˆ·æ–°</button>
      <button class="action-btn" bindtap="clearLogs">æ¸…ç©ºæ—¥å¿—</button>
      <button class="action-btn" bindtap="exportLogs">å¯¼å‡ºæ—¥å¿—</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>