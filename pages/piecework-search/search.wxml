<!-- pages/piecework-search/search.wxml -->
<view class="container">
  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-card">
    <view class="filter-title">ç­›é€‰æ¡ä»¶</view>

    <!-- å·¥äººå§“å -->
    <view class="filter-row">
      <text class="filter-label">å·¥äººå§“å</text>
      <picker range="{{workerNames}}" value="{{workerIndex}}" bindchange="onWorkerChange">
        <view class="filter-picker">{{selectedWorker || 'å…¨éƒ¨'}}</view>
      </picker>
    </view>

    <!-- äº§å“åç§° -->
    <view class="filter-row">
      <text class="filter-label">äº§å“åç§°</text>
      <picker range="{{productNames}}" value="{{productIndex}}" bindchange="onProductChange">
        <view class="filter-picker">{{selectedProduct || 'å…¨éƒ¨'}}</view>
      </picker>
    </view>

    <!-- è§„æ ¼ -->
    <view class="filter-row">
      <text class="filter-label">è§„æ ¼</text>
      <picker range="{{specifications}}" value="{{specIndex}}" bindchange="onSpecChange">
        <view class="filter-picker">{{selectedSpec || 'å…¨éƒ¨'}}</view>
      </picker>
    </view>

    <!-- æè´¨ -->
    <view class="filter-row">
      <text class="filter-label">æè´¨</text>
      <picker range="{{materials}}" value="{{materialIndex}}" bindchange="onMaterialChange">
        <view class="filter-picker">{{selectedMaterial || 'å…¨éƒ¨'}}</view>
      </picker>
    </view>

    <!-- æ—¥æœŸèŒƒå›´ -->
    <view class="filter-row">
      <text class="filter-label">æ—¥æœŸèŒƒå›´</text>
      <view class="date-range">
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="date-picker">{{startDate || 'å¼€å§‹'}}</view>
        </picker>
        <text class="date-sep">è‡³</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="date-picker">{{endDate || 'ç»“æŸ'}}</view>
        </picker>
      </view>
    </view>

    <!-- å¿«æ·ç­›é€‰ -->
    <view class="quick-filters">
      <view class="quick-btn {{onlySemi ? 'active' : ''}}" bindtap="toggleSemi">åªçœ‹åŠæˆå“</view>
      <view class="quick-btn {{onlyFinished ? 'active' : ''}}" bindtap="toggleFinished">åªçœ‹æˆå“</view>
      <view class="quick-btn {{onlyDefect ? 'active' : ''}}" bindtap="toggleDefect">åªçœ‹æŠ¥åºŸ</view>
    </view>

    <!-- æŒ‰é’® -->
    <view class="filter-btns">
      <view class="reset-btn" bindtap="resetFilter">é‡ç½®</view>
      <view class="search-btn" bindtap="doSearch">æŸ¥è¯¢</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="summary-card" wx:if="{{searched}}">
    <view class="summary-left">
      <view class="summary-item">
        <text class="summary-value">{{records.length}}</text>
        <text class="summary-label">æ¡è®°å½•</text>
      </view>
      <view class="summary-item">
        <text class="summary-value">{{totalQuantity}}</text>
        <text class="summary-label">æ€»æ•°é‡</text>
      </view>
      <view class="summary-item">
        <text class="summary-value text-success">Â¥{{totalAmount}}</text>
        <text class="summary-label">æ€»é‡‘é¢</text>
      </view>
    </view>
    <view class="export-btn" bindtap="exportToExcel" wx:if="{{records.length > 0}}">
      <text class="export-icon">ğŸ“Š</text>
      <text>å¯¼å‡ºExcel</text>
    </view>
  </view>

  <!-- ç»“æœåˆ—è¡¨ -->
  <view class="results-section" wx:if="{{searched}}">
    <scroll-view scroll-y class="results-list" wx:if="{{records.length > 0}}">
      <view class="record-card {{item.defectQuantity > 0 ? 'has-defect' : ''}}" 
        wx:for="{{records}}" wx:key="id" bindtap="goToDetail" data-record="{{item}}">
        <view class="defect-badge" wx:if="{{item.defectQuantity > 0}}">æŠ¥åºŸ{{item.defectQuantity}}</view>
        <view class="record-header">
          <text class="product-name">{{item.productName}}</text>
          <text class="semi-tag" wx:if="{{item.semiFinished === 'æ˜¯'}}">åŠæˆå“</text>
          <text class="worker-name">{{item.workerName}}</text>
        </view>
        <view class="record-specs">
          <text class="spec-tag">{{item.specification}}</text>
          <text class="spec-tag">{{item.material}}</text>
          <text class="work-date">{{item.workDate ? item.workDate.substring(0, 10) : ''}}</text>
        </view>
        <view class="record-footer">
          <text class="quantity">{{item.quantity}} {{item.unit || 'ä¸ª'}}</text>
          <text class="amount">Â¥{{item.totalAmount}}</text>
        </view>
      </view>
    </scroll-view>
    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•</text>
    </view>
  </view>
</view>

