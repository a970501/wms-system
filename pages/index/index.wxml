<!-- pages/index/index.wxml -->
<view class="container">
  <!-- ç¦»çº¿çŠ¶æ€ç»„ä»¶ -->
  <offline-status show-details="{{true}}" position="top" />

  <!-- æ¬¢è¿åŒºåŸŸ -->
  <view class="welcome-card">
    <view class="welcome-text">
      <text class="greeting">æ¬¢è¿å›æ¥</text>
      <text class="username">{{userInfo.username || 'ç”¨æˆ·'}}</text>
    </view>
    <view class="date-info">
      <text>{{currentDate}}</text>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-title">ä»Šæ—¥æ¦‚è§ˆ</view>
    <view class="stats-grid">
      <view class="stat-card" bindtap="goToPiecework">
        <view class="stat-icon">ğŸ“‹</view>
        <view class="stat-value">{{todayPiecework}}</view>
        <view class="stat-label">ä»Šæ—¥è®¡ä»¶</view>
      </view>
      <view class="stat-card" bindtap="goToInventory">
        <view class="stat-icon">ğŸ“¦</view>
        <view class="stat-value">{{totalInventory}}</view>
        <view class="stat-label">åº“å­˜æ€»æ•°</view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="section-title">å¿«æ·æ“ä½œ</view>
    <view class="action-grid">
      <view class="action-item" bindtap="goToAddPiecework">
        <view class="action-icon">â•</view>
        <text class="action-text">æ·»åŠ è®¡ä»¶</text>
      </view>
      <view class="action-item" bindtap="goToInventory">
        <view class="action-icon">ğŸ”</view>
        <text class="action-text">æŸ¥çœ‹åº“å­˜</text>
      </view>
      <view class="action-item" bindtap="goToMyPiecework">
        <view class="action-icon">ğŸ“Š</view>
        <text class="action-text">æˆ‘çš„è®¡ä»¶</text>
      </view>
      <view class="action-item" bindtap="refreshData">
        <view class="action-icon">ğŸ”„</view>
        <text class="action-text">åˆ·æ–°æ•°æ®</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="recent-section">
    <view class="section-title">æœ€è¿‘è®¡ä»¶è®°å½•</view>
    <view class="recent-list" wx:if="{{recentRecords.length > 0}}">
      <view class="record-item {{item.defectQuantity > 0 ? 'has-defect' : ''}}" wx:for="{{recentRecords}}" wx:key="id" bindtap="goToDetail" data-record="{{item}}">
        <view class="record-main">
          <view class="product-row">
            <text class="record-product">{{item.productName}}</text>
            <text class="semi-tag" wx:if="{{item.semiFinished === 'æ˜¯'}}">åŠæˆå“</text>
          </view>
          <view class="record-tags">
            <text class="tag spec-tag" wx:if="{{item.specification}}">{{item.specification}}</text>
            <text class="tag material-tag" wx:if="{{item.material}}">{{item.material}}</text>
          </view>
        </view>
        <view class="record-info">
          <text class="record-quantity">{{item.quantity}} {{item.unit && item.unit !== 'null' ? item.unit : 'ä¸ª'}}</text>
          <text class="record-amount">Â¥{{item.totalAmount}}</text>
        </view>
        <!-- æŠ¥åºŸè§’æ ‡ -->
        <view class="defect-badge" wx:if="{{item.defectQuantity > 0}}">
          <text>æŠ¥åºŸ{{item.defectQuantity}}</text>
        </view>
      </view>
    </view>
    <view class="empty-state" wx:else>
      <text class="empty-text">æš‚æ— è®¡ä»¶è®°å½•</text>
    </view>
  </view>
</view>

