<!-- pages/piecework/piecework.wxml -->
<view class="container">
  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <input
      class="search-input"
      placeholder="æœç´¢äº§å“åç§°/è§„æ ¼"
      value="{{keyword}}"
      bindinput="onKeywordInput"
      bindconfirm="searchRecords"
    />
    <view class="clear-btn" wx:if="{{keyword}}" bindtap="clearKeyword">Ã—</view>
  </view>

  <!-- æ—¥æœŸç­›é€‰ -->
  <view class="filter-section">
    <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
      <view class="date-picker">
        <text>{{startDate || 'å¼€å§‹æ—¥æœŸ'}}</text>
      </view>
    </picker>
    <text class="date-separator">è‡³</text>
    <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
      <view class="date-picker">
        <text>{{endDate || 'ç»“æŸæ—¥æœŸ'}}</text>
      </view>
    </picker>
    <view class="filter-btn" bindtap="searchRecords">ç­›é€‰</view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å’Œå¯¼å‡ºæŒ‰é’® -->
  <view class="summary-card">
    <view class="summary-left">
      <view class="summary-item">
        <text class="summary-label">æ€»æ•°é‡</text>
        <text class="summary-value">{{totalQuantity}}</text>
      </view>
      <view class="summary-divider"></view>
      <view class="summary-item">
        <text class="summary-label">æ€»é‡‘é¢</text>
        <text class="summary-value text-success">Â¥{{totalAmount}}</text>
      </view>
    </view>
    <view class="export-btn" bindtap="exportRecords" wx:if="{{records.length > 0}}">
      <text class="export-icon">ğŸ“Š</text>
      <text>å¯¼å‡º</text>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="records-section">
    <view class="section-header">
      <text class="section-title">è®¡ä»¶è®°å½•</text>
      <text class="record-count">å…± {{records.length}} æ¡</text>
    </view>

    <scroll-view
      scroll-y
      class="records-list"
      bindscrolltolower="loadMore"
      wx:if="{{records.length > 0}}"
    >
      <view class="record-card {{item.defectQuantity > 0 ? 'has-defect' : ''}}" wx:for="{{records}}" wx:key="id" bindtap="goToDetail" data-record="{{item}}">
        <!-- æŠ¥åºŸè§’æ ‡ -->
        <view class="defect-badge" wx:if="{{item.defectQuantity > 0}}">æŠ¥åºŸ{{item.defectQuantity}}</view>

        <view class="record-header">
          <view class="product-row">
            <text class="product-name">{{item.productName}}</text>
            <text class="semi-tag" wx:if="{{item.semiFinished === 'æ˜¯'}}">åŠæˆå“</text>
          </view>
          <text class="work-date">{{item.workDate ? item.workDate.substring(0, 10) : ''}}</text>
        </view>

        <view class="record-specs">
          <text class="tag spec-tag" wx:if="{{item.specification}}">{{item.specification}}</text>
          <text class="tag material-tag" wx:if="{{item.material}}">{{item.material}}</text>
        </view>

        <view class="record-footer">
          <view class="footer-left">
            <text class="quantity-label">æ•°é‡</text>
            <text class="quantity-value">{{item.quantity}}</text>
            <text class="quantity-unit">{{item.unit && item.unit !== 'null' ? item.unit : 'ä¸ª'}}</text>
          </view>
          <view class="footer-right">
            <text class="price-text">Â¥{{item.unitPrice || 0}}/ä¸ª</text>
            <text class="amount-text">Â¥{{item.totalAmount || '0.00'}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¡ä»¶è®°å½•</text>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn" bindtap="addRecord">
    <text>+</text>
  </view>
</view>

