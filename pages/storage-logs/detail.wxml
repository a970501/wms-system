<!-- pages/storage-logs/detail.wxml -->
<view class="container">
  <view class="detail-card" wx:if="{{log}}">
    <!-- æ—¥æœŸå¤´éƒ¨ -->
    <view class="header">
      <text class="date">{{log.log_date}}</text>
      <view class="status" wx:if="{{log.failed_count > 0}}">
        <text class="status-text">{{log.failed_count}}æ¡å¼‚å¸¸</text>
      </view>
      <view class="status success" wx:else>
        <text class="status-text">å…¨éƒ¨æˆåŠŸ</text>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="section">
      <view class="section-title">ğŸ“Š ç»Ÿè®¡æ¦‚è§ˆ</view>
      <view class="info-grid">
        <view class="info-item">
          <text class="info-label">åŠæˆå“è®¡ä»¶</text>
          <text class="info-value">{{log.semi_finished_count}}æ¡</text>
        </view>
        <view class="info-item">
          <text class="info-label">è®¡ä»¶æ€»æ•°</text>
          <text class="info-value">{{log.semi_finished_quantity}}ä¸ª</text>
        </view>
        <view class="info-item">
          <text class="info-label">å…¥åº“è®°å½•</text>
          <text class="info-value success">{{log.storage_count}}æ¡</text>
        </view>
        <view class="info-item">
          <text class="info-label">å…¥åº“æ€»æ•°</text>
          <text class="info-value success">{{log.storage_quantity}}ä¸ª</text>
        </view>
        <view class="info-item">
          <text class="info-label">å·¥äººæ•°</text>
          <text class="info-value">{{log.worker_count}}äºº</text>
        </view>
        <view class="info-item">
          <text class="info-label">äº§å“ç§ç±»</text>
          <text class="info-value">{{log.product_types}}ç§</text>
        </view>
      </view>
    </view>

    <!-- æœªå…¥åº“è®°å½• -->
    <view class="section" wx:if="{{failedRecords && failedRecords.length > 0}}">
      <view class="section-title warning">âš ï¸ æœªå…¥åº“è®°å½•</view>
      <view class="failed-list">
        <view class="failed-item" wx:for="{{failedRecords}}" wx:key="id">
          <view class="failed-header">
            <text class="failed-product">{{item.product_name}}</text>
            <text class="failed-spec">{{item.specification}}</text>
          </view>
          <view class="failed-info">
            <text class="info-text">æ•°é‡: {{item.quantity}}ä¸ª</text>
            <text class="info-text">å·¥äºº: {{item.worker_name}}</text>
          </view>
          <view class="failed-reason" wx:if="{{item.reason}}">
            <text class="reason-text">åŸå› : {{item.reason}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- å…¥åº“æ˜ç»† -->
    <view class="section" wx:if="{{storageDetails && storageDetails.length > 0}}">
      <view class="section-title">âœ… å…¥åº“æ˜ç»†</view>
      <view class="detail-list">
        <view class="detail-item" wx:for="{{storageDetails}}" wx:key="index">
          <view class="detail-row">
            <text class="detail-product">{{item.product}}</text>
            <text class="detail-type">{{item.type === 'parts' ? 'é›¶ä»¶å…¥åº“' : item.type === 'blank' ? 'æ¯›å¯æ¶ˆè€—' : 'æˆå“å…¥åº“'}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">æ¬¡æ•°: {{item.count}}</text>
            <text class="detail-qty" wx:if="{{item.qty >= 0}}">+{{item.qty}}ä¸ª</text>
            <text class="detail-qty negative" wx:else>{{item.qty}}ä¸ª</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
